{
  "project_name": "memtrace",
  "analysis_version": "2.0",
  "analysis_date": "2026-02-13",
  "storage": {
    "vector_database": {
      "type": "none",
      "provider": "无向量数据库 - 核心设计原则",
      "embedding_dimensions": 0,
      "estimated_storage_per_1m_vectors": "N/A",
      "index_type": "N/A",
      "distance_metric": "N/A",
      "code_evidence": {
        "file": "go.mod",
        "details": "无任何向量数据库或嵌入相关依赖,架构明确采用无嵌入纯文本设计"
      }
    },
    "primary_database": {
      "type": "Arc Time-Series Database",
      "version": "自建Arc DB实例",
      "usage": "时序记忆存储,Parquet列式存储格式,5-10x压缩率",
      "connection_pattern": "HTTP API with API key认证,10 idle connections per instance",
      "code_evidence": {
        "file": "go.mod + internal/",
        "details": "通过HTTP API连接Arc DB,端口8000,支持SQL时序查询"
      }
    },
    "graph_database": {
      "type": "none",
      "usage": "N/A"
    },
    "cache": {
      "type": "内存写缓冲",
      "usage": "100MB写缓冲区(10K records),批量刷新到Arc DB",
      "ttl_strategy": "基于时间序列的自然过期和归档",
      "code_evidence": {
        "file": "internal/",
        "details": "Go内存缓冲区实现写批处理,1秒flush间隔"
      }
    },
    "object_storage": {
      "type": "Parquet文件备份",
      "usage": "Arc DB的Parquet文件可备份到S3/GCS/OBS"
    },
    "data_scale": {
      "estimated_size": "<1GB (1K memories/day) 到 100GB-1TB (1M+ memories/day)",
      "growth_rate": "线性增长,Parquet压缩5-10x",
      "retention_policy": "时间分区 + 归档策略,>100M记忆需要时间分区"
    },
    "performance": {
      "read_latency": "10-200ms (Arc SQL查询)",
      "write_latency": "<100ms (缓冲写入)",
      "throughput": "500-1000 writes/sec/instance, 可水平扩展到10K/sec"
    }
  },
  "compute": {
    "cpu": {
      "minimum": "2 vCPUs",
      "recommended": "4-8 vCPUs",
      "workload_type": "I/O-bound + 轻量CPU(Go运行时,写批处理)",
      "code_evidence": {
        "file": "Dockerfile",
        "details": "Go 1.25 Alpine构建,CGO_ENABLED=1(SQLite依赖),最终镜像极小"
      }
    },
    "memory": {
      "minimum": "512MB",
      "recommended": "2-4GB",
      "peak_usage_scenario": "100MB写缓冲区(10K records) + Go运行时"
    },
    "gpu": {
      "required": false,
      "usage": "完全不使用GPU - 零ML工作负载",
      "cuda_dependencies": [],
      "gpu_code_locations": [],
      "frameworks": [],
      "code_evidence": {
        "file": "go.mod",
        "details": "纯Go语言项目,依赖仅有fiber/sqlite3/viper/zerolog/msgpack/crypto,无任何ML/GPU相关依赖"
      }
    },
    "ascend_npu": {
      "compatibility": "not_applicable",
      "migration_effort": "none",
      "analysis": "项目完全不涉及GPU/NPU计算。Go语言实现,无ML工作负载,无嵌入计算,无模型推理。架构核心设计原则就是避免嵌入和向量计算。",
      "required_changes": [],
      "cann_toolkit_version": "N/A",
      "torch_ascend_support": "N/A - Go语言项目,无torch依赖",
      "alternative_solutions": [
        "无需NPU适配,项目设计上就是LLM不可知的纯文本时序记忆"
      ]
    },
    "scalability": {
      "horizontal": true,
      "auto_scaling_support": true,
      "scaling_strategy": "无状态设计,负载均衡;1实例500-1000 writes/sec,3实例1500-3000,10实例5000-10000(需Arc集群)",
      "code_evidence": {
        "file": "Dockerfile + architecture",
        "details": "Stateless Go binary, load-balanced, horizontal scaling with write throughput vertical scaling"
      }
    },
    "serverless": {
      "compatible": false,
      "limitations": "需要持久状态(SQLite元数据)和Arc DB连接,不适合Serverless",
      "recommended_services": ["ECS/CCE容器部署"]
    },
    "concurrency": {
      "model": "Go goroutines (高并发原生支持)",
      "estimated_concurrent_users": "500-1000 concurrent writes per instance",
      "bottlenecks": "Arc DB写入吞吐量, SQLite单文件限制(HA需迁移PostgreSQL)"
    }
  },
  "external_services": {
    "llm_providers": [],
    "other_apis": [
      {
        "name": "Arc Database",
        "usage": "核心时序存储后端",
        "required": true
      }
    ]
  },
  "deployment": {
    "docker": {
      "has_dockerfile": true,
      "base_image": "golang:1.25-alpine (build) + alpine:3.21 (runtime)",
      "multi_stage": true,
      "size_estimate": "~20MB (Go static binary + Alpine)",
      "code_evidence": {
        "file": "Dockerfile",
        "details": "Multi-stage build, CGO_ENABLED=1 for SQLite, exposes port 9100, minimal Alpine runtime"
      }
    },
    "kubernetes": {
      "ready": true,
      "helm_chart": false,
      "resource_limits": {
        "cpu": "2-8 cores",
        "memory": "2-4Gi",
        "gpu": "none"
      },
      "notes": "需要PersistentVolume for SQLite, Arc DB需独立部署"
    },
    "configuration": {
      "env_vars": ["ARC_URL", "ARC_API_KEY", "API_KEY"],
      "config_files": ["memtrace.toml"],
      "secrets_management": "TOML配置 + 环境变量, 推荐AWS Secrets Manager/GCP Secret Manager/Vault"
    },
    "observability": {
      "logging": "结构化JSON日志到stdout (zerolog)",
      "metrics": "健康端点 /health, /ready + 自定义指标",
      "tracing": "无内置分布式追踪",
      "health_checks": "/health (liveness), /ready (Arc connectivity)"
    }
  },
  "huawei_cloud": {
    "recommended_services": {
      "compute": {
        "service": "CCE (Cloud Container Engine) 或 ECS",
        "spec": "通用计算型 4vCPU/4GB RAM",
        "justification": "Go微服务,低资源消耗,高并发能力"
      },
      "database": {
        "service": "ECS自建Arc DB + GaussDB(for PostgreSQL)替代SQLite",
        "spec": "Arc DB: 4vCPU/8GB RAM; PostgreSQL: 2vCPU/4GB(替代SQLite实现HA)",
        "justification": "Arc DB需自建(非华为云托管服务);SQLite需迁移PostgreSQL实现高可用",
        "limitations": "Arc DB为非主流数据库,华为云无托管服务,需自行运维",
        "alternatives": [
          "GaussDB(for Influx)替代Arc DB(需适配层)",
          "CSS Elasticsearch作为时序查询替代",
          "IoTDA数据分析作为时序存储"
        ]
      },
      "storage": {
        "service": "EVS SSD + OBS",
        "justification": "EVS for SQLite/Arc持久化, OBS for Parquet备份"
      },
      "networking": {
        "service": "VPC + ELB",
        "justification": "内网通信,端口9100 HTTP, 端口8000 Arc内部通信"
      }
    },
    "cost_estimation": {
      "monthly": {
        "small": "$20-50 (ECS 2vCPU + EVS 10GB)",
        "medium": "$150-300 (2x ECS + ECS for Arc + ELB)",
        "large": "$500-1500 (CCE集群 + Arc集群 + GaussDB)"
      },
      "notes": "极低基础设施成本,无LLM API费用,无嵌入计算费用。主要成本为计算和存储"
    },
    "special_requirements": {
      "arc_db": "需自建Arc DB,华为云无托管版本,建议容器化部署在CCE",
      "sqlite_ha": "SQLite单文件不支持HA,生产环境建议迁移到GaussDB(for PostgreSQL)",
      "persistent_volume": "需要PersistentVolume for SQLite数据",
      "network_ports": "9100 (API), 8000 (Arc内部通信)"
    },
    "architecture_recommendations": [
      "使用CCE部署Memtrace容器和Arc DB容器",
      "将SQLite替换为GaussDB(for PostgreSQL)实现高可用",
      "使用OBS存储Parquet备份文件",
      "配置ELB for API负载均衡(端口9100)",
      "使用VPC Peering连接Memtrace和Arc DB",
      "利用AOM(应用运维管理)收集结构化JSON日志",
      "考虑使用GaussDB(for Influx)替代Arc DB减少运维复杂度"
    ]
  }
}